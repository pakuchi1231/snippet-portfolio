<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Snippet Share ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; }
    h1 { color: #333; }
    .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .snippet-item { background: #eee; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
    pre { background: #222; color: #0f0; padding: 10px; overflow-x: auto; border-radius: 4px; }
  </style>
</head>
<body>

  <h1>ğŸ“ Snippet Share API</h1>
  
  <div class="card">
    <h3>æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹</h3>
    <form id="snippet-form">
      <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ« (ä¾‹: ã¯ã˜ã‚ã¦ã®Python)" required>
      <textarea id="code" rows="5" placeholder="ã‚³ãƒ¼ãƒ‰ã®ä¸­èº«ã‚’æ›¸ã„ã¦ãã ã•ã„..." required></textarea>
      <button type="submit">AWSã«ä¿å­˜ï¼</button>
    </form>
    <p id="message" style="color: green; font-weight: bold;"></p>
  </div>

  <div class="card">
    <h3>ä¿å­˜ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ä¸€è¦§</h3>
    <button onclick="loadSnippets()" style="background-color: #28a745; margin-bottom: 10px;">æ›´æ–°ã™ã‚‹</button>
    <div id="snippet-list">
      </div>
  </div>

  <script>
    // â˜…â˜…â˜… ã“ã“ã‚’ã‚ãªãŸã®URLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼ â˜…â˜…â˜…
    const API_URL = "https://kj77nq93g5.execute-api.ap-northeast-1.amazonaws.com/prod/snippets";

    // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹å‡¦ç†
    document.getElementById('snippet-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const code = document.getElementById('code').value;

      document.getElementById('message').innerText = "ä¿å­˜ä¸­...";

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, code, language: "text" })
        });

        if(response.ok) {
          document.getElementById('message').innerText = "âœ… ä¿å­˜æˆåŠŸï¼";
          document.getElementById('snippet-form').reset();
          loadSnippets(); // ä¿å­˜ã—ãŸã‚‰è‡ªå‹•ã§ä¸€è¦§ã‚’æ›´æ–°
        } else {
          document.getElementById('message').innerText = "âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
        }
      } catch (error) {
        document.getElementById('message').innerText = "âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã§ã™";
      }
    });

    // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€å‡¦ç†
    async function loadSnippets() {
      const listDiv = document.getElementById('snippet-list');
      listDiv.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";

      try {
        const response = await fetch(API_URL);
        const data = await response.json();
        
        listDiv.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢
        
        data.forEach(item => {
          const div = document.createElement('div');
          div.className = "snippet-item";
          div.innerHTML = `
            <strong>${item.title || 'ç„¡é¡Œ'}</strong> (ID: ${item.id})
            <pre><code>${item.code || ''}</code></pre>
          `;
          listDiv.appendChild(div);
        });
      } catch (error) {
        listDiv.innerHTML = "âŒ ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";
      }
    }

    // ç”»é¢ã‚’é–‹ã„ãŸã¨ãã«è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    loadSnippets();
  </script>

</body>
</html>